<div class="container-fluid">
    <div class="row">
        <div class="col-12">
          <h3 class="page-title">{{pageTitle}}</h3>
          <h6 class="page-title-second-text" *ngIf="isPurchased">
            –¢–æ–≤–∞—Ä - —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ (–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–µ—Ç—Å—è –≤ –≥–æ—Ç–æ–≤–æ–º –≤–∏–¥–µ) 
            <span style="font-size: 20px"> üßÉ</span>
          </h6>
          <h6 class="page-title-second-text" *ngIf="!isPurchased">
            –¢–µ—Ö –∫–∞—Ä—Ç–∞ - —ç—Ç–æ –ø—Ä–æ–¥–∞–≤–∞–µ–º—ã–π –ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–æ—Ç–æ–≤–∏—Ç –∑–∞–≤–µ–¥–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
            <span style="font-size: 20px"> üç≥</span>
          </h6>
        </div>
    </div>
    <hr>
    <app-page-loader [show]="loader"></app-page-loader>
    <form [formGroup]="createForm" (ngSubmit)="onSubmit()" *ngIf="!loader">
        <div class="row">
            <div [ngClass]="{'col-md-6': isPurchased}" [class]="(isPurchased ? 'col-md-6' : 'col-md-8') + ' col-sm-12'">
                <div class="card shadow p-3 ml-2 mb-4" [ngClass]="{'form50': !isPurchased}">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-control f50" formControlName="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    <small class="invalid" *ngIf="submitted && createForm.get('title').invalid">–≠—Ç–æ –ø–æ–ª–µ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å</small>

                    <label class="mt-3">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-control f50" formControlName="category">
                        <option [ngValue]="null">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option [value]="category.id" *ngFor="let category of categories">{{category.title}}</option>
                    </select>
                    <small class="invalid" *ngIf="submitted && createForm.get('category').invalid">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</small>

                    <div class="ingredients-container mt-3 p-3" *ngIf="!isPurchased">
                        
                        <label class="mt-2 mb-2">–£–∫–∞–∂–∏—Ç–µ —Å–æ—Å—Ç–∞–≤</label>
                        <table mdbTable bordered="true" striped="true" class="ing-table">
                            <thead>
                              <tr>
                                <th scope="col">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</th>
                                <th scope="col" style="width: 25%">–£–¥–µ–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</th>
                                <th scope="col" style="width: 15%">–¶–µ–Ω–∞ –∑–∞ –µ–¥.</th>
                                <th scope="col" style="width: 15%">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                <th scope="col" style="width: 5%"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngIf="!ingredientsRows.length">
                                  <td colspan="5" style="text-align: center"><span>–î–æ–±–∞–≤—å—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</span></td>
                              </tr>
                              <tr mdbTableCol *ngFor="let item of ingredientsRows; let i = index">
                                <td>
                                    <select class="form-control" [ngModelOptions]="{standalone: true}" 
                                        [(ngModel)]="item.ingredientId" (change)="selectIngredient($event, i)">
                                        <option [ngValue]="null">–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</option>
                                        <option *ngFor="let ing of ingredients | ingredientsFilter:selectedIngredients:item.ingredientId" 
                                            [value]="ing.id">{{ing.title}}</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="d-flex">
                                        <input type="number" min="0" class="form-control" [ngModelOptions]="{standalone: true}"
                                            [(ngModel)]="item.specificConsumption" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                                        <span class="ml-2">–º–ª.</span>
                                    </div>
                                </td>
                                <td style="text-align: center">‚Ç¥ {{item.unitPrice}}</td>
                                <td style="text-align: center">‚Ç¥ {{item.costPrice}}</td>
                                <td><span class="material-icons-outlined remove-ing" (click)="removeIngredient(i)"
                                    title="–£–±—Ä–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç">cancel_presentation</span></td>
                              </tr>
                            </tbody>
                        </table>
                        <small class="invalid" *ngIf="submitted && !ingredientsIsValid">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –Ω–µ –≤–µ—Ä–Ω–æ</small>
                        <small class="invalid" *ngIf="submitted && !ingredientsRows.length">–°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º</small>
                    </div>
                    {{selectedIngredients | json}}
                    <div class="d-flex justify-content-between">
                        <button mdbBtn size="sm" color="deep-orange" type="button" (click)="addIngredient()">
                            <div class="btn-content">
                                <span class="material-icons-outlined icon">add</span> –î–æ–±–∞–≤–∏—Ç—å
                            </div>
                        </button>

                        <div *ngIf="ingredientsRows.length">
                            <label class="mt-2"><b>–°—É–º–º–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏:</b></label>
                            <span class="ml-2">‚Ç¥ {{costPrice}}</span>
                        </div>
                    </div>

                    <ng-container *ngIf="isPurchased">
                        <label class="mt-3">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="number" min="0" step=".1" [ngModelOptions]="{standalone: true}" 
                            [(ngModel)]="costPrice" class="form-control f50" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                        <small class="invalid" *ngIf="costPrice < 0 && submitted">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0</small>
                    </ng-container>

                    <label class="mt-3">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                    <input type="number" min="0" step=".1" formControlName="price" class="form-control f50" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                    <small class="invalid" *ngIf="submitted && createForm.get('price').invalid">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</small>

                    <label class="mt-3">–í–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                    <div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="published" value="1" class="custom-control-input" id="statusTrue" formControlName="published" mdbInput>
                            <label class="custom-control-label" for="statusTrue">–î–æ—Å—Ç—É–ø–Ω–æ</label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="published" value="0" class="custom-control-input" id="statusFalse" formControlName="published" mdbInput>
                            <label class="custom-control-label" for="statusFalse">–°–∫—Ä—ã—Ç–æ</label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center">
                        <button type="submit" mdbBtn color="success" class="mt-4" style="width: 35%" size="md">–°–æ–∑–¥–∞—Ç—å</button>
                    </div>

                </div>
            </div>
        </div>
    </form>
</div>