<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h3 class="page-title">–ù–æ–≤–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞</h3>
            <h6 class="page-title-second-text" *ngIf="isPurchased">
                –ü–æ—Å—Ç–∞–≤–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤
                <span style="font-size: 20px"> üöö</span>
            </h6>
        </div>
    </div>
    <hr>
    <app-page-loader [show]="loader"></app-page-loader>
    <form [formGroup]="createForm" (ngSubmit)="onSubmit()" *ngIf="!loader">
        <div class="row">
            <div class="col-md-8 col-sm-12">
                <div class="card shadow p-3 ml-2 mb-4" —Ålass="form50">
                    <label class="mt-3">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                    <select class="form-control f50" formControlName="supplier">
                        <option [ngValue]="null">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</option>
                        <option [value]="supplier.id" *ngFor="let supplier of suppliers">{{supplier.name}}</option>
                    </select>
                    <small class="invalid" *ngIf="submitted && createForm.get('supplier').invalid">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</small>

                    <label class="mt-3">–°—á–µ—Ç –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤</label>
                    <select class="form-control f50" formControlName="account">
                        <option [ngValue]="null">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç</option>
                        <option [value]="account.id" *ngFor="let account of accounts">{{account.title}}</option>
                    </select>
                    <small class="invalid" *ngIf="submitted && createForm.get('account').invalid">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç</small>

                    <label class="mt-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea formControlName="comment" cols="20" rows="5"></textarea>

                    <div class="ingredients-container mt-3 p-3">
                        
                        <table mdbTable bordered="true" striped="true" class="ing-table">
                            <thead>
                              <tr>
                                <th scope="col">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</th>
                                <th scope="col" style="width: 25%">–§–∞—Å–æ–≤–∫–∞</th>
                                <th scope="col" style="width: 15%">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th scope="col" style="width: 3%"></th>
                                <th scope="col" style="width: 15%">–¶–µ–Ω–∞ –∑–∞ –µ–¥.</th>
                                <th scope="col" style="width: 3%"></th>
                                <th scope="col" style="width: 15%">–í—Å–µ–≥–æ</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngIf="!ingredientsRows.length">
                                  <td colspan="5" style="text-align: center"><span>–î–æ–±–∞–≤—å—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</span></td>
                              </tr>
                              <tr mdbTableCol *ngFor="let item of deliveryRows; let i = index">
                                <td>
                                    <select class="form-control" [ngModelOptions]="{standalone: true}" 
                                        [(ngModel)]="item.ingredientId" (change)="onSelectIngredient(item)">
                                        <option [ngValue]="null">–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</option>
                                        <option *ngFor="let ing of ingredients | ingredientsFilter:selectedIngredients:item.ingredientId" 
                                            [value]="ing.id">{{ing.title}}</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="d-flex">
                                        <input type="number" min="0" class="form-control" [ngModelOptions]="{standalone: true}"
                                            [(ngModel)]="item.usingInOne" (input)="usedInOneChnage(i)" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                                        <span class="ml-2">{{item.unit}}</span>
                                    </div>
                                </td>
                                <td style="text-align: center">‚Ç¥ {{item.unitPrice}}</td>
                                <td style="text-align: center">‚Ç¥ {{item.costPrice}}</td>
                                <td><span class="material-icons-outlined remove-ing" (click)="removeIngredient(i)"
                                    title="–£–±—Ä–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç">cancel_presentation</span></td>
                              </tr>
                            </tbody>
                        </table>
                        <small class="invalid" *ngIf="submitted && !ingredientsIsValid">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –Ω–µ –≤–µ—Ä–Ω–æ</small>
                        <small class="invalid" *ngIf="submitted && !ingredientsRows.length">–°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º</small>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button mdbBtn size="sm" color="deep-orange" type="button" (click)="addIngredient()">
                            <div class="btn-content">
                                <span class="material-icons-outlined icon">add</span> –î–æ–±–∞–≤–∏—Ç—å
                            </div>
                        </button>

                        <div *ngIf="ingredientsRows.length">
                            <label class="mt-2"><b>–°—É–º–º–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏:</b></label>
                            <span class="ml-2">‚Ç¥ {{costPrice}}</span>
                        </div>
                    </div>

                    <ng-container *ngIf="isPurchased">
                        <label class="mt-3">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="number" min="0" step=".1" [ngModelOptions]="{standalone: true}" 
                            [(ngModel)]="costPrice" class="form-control f50" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                        <small class="invalid" *ngIf="costPrice < 0 && submitted">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0</small>
                    </ng-container>

                    <label class="mt-3">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                    <input type="number" min="0" step=".1" formControlName="price" class="form-control f50" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                    <small class="invalid" *ngIf="submitted && createForm.get('price').invalid">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</small>

                    <label class="mt-3">–í–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                    <div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="published" value="1" class="custom-control-input" id="statusTrue" formControlName="published" mdbInput>
                            <label class="custom-control-label" for="statusTrue">–î–æ—Å—Ç—É–ø–Ω–æ</label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="published" value="0" class="custom-control-input" id="statusFalse" formControlName="published" mdbInput>
                            <label class="custom-control-label" for="statusFalse">–°–∫—Ä—ã—Ç–æ</label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center">
                        <button type="submit" mdbBtn color="success" class="mt-4" style="width: 35%" size="md">
                            {{isEdit ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–°–æ–∑–¥–∞—Ç—å'}}
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </form>
</div>